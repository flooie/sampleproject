name: Python
on:
  pull_request:
    types: [closed]

jobs:
  py:
    runs-on: ubuntu-latest
    steps:
      - name: Display the path
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: |
          import os, json, urllib
          context = json.loads(os.environ['GITHUB_CONTEXT'])
          current_sha1 = context["sha"]
          tags = json.loads(urllib.urlopen("https://api.github.com/repos/flooie/sampleproject/tags").read())
          tagged_sha1 = tags[0]['commit']['sha']
          ids = [id for id in context['event']['commits']]
          if tagged_sha1 in ids:
            print("HIT")
            print("We have a PR with a PyPI tag inside of it and we need to send it off")
            print(tags[0]['commit']['name'])

        shell: python
